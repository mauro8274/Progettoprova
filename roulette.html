<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roulette Interattiva</title>
    <style>
        /* --- STILI GENERALI E SFONDO --- */
        body {
            background-color: #000000;
            color: #ffffff;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            /* Sfondo Stellato */
            background-image: radial-gradient(white, rgba(255, 255, 255, 0.2) 2px, transparent 40px),
                              radial-gradient(white, rgba(255, 255, 255, 0.15) 1px, transparent 30px),
                              radial-gradient(white, rgba(255, 255, 255, 0.1) 2px, transparent 40px),
                              radial-gradient(rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0.1) 2px, transparent 30px);
            background-size: 550px 550px, 350px 350px, 250px 250px, 150px 150px;
            background-position: 0 0, 40px 60px, 130px 270px, 70px 30px;
        }

        .container {
            display: flex;
            gap: 40px;
            max-width: 1200px;
            width: 100%;
        }

        /* --- CONTROLLI GIOCO (CASSA E FICHE) --- */
        .game-controls {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            width: 100%;
        }
        .game-controls input, .game-controls button {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #444;
            background-color: #333;
            color: white;
        }
        .info-box {
            background-color: #2c2c2c;
            padding: 10px;
            border-radius: 5px;
            min-width: 150px;
            text-align: center;
        }

        /* --- TAVOLO DA ROULETTE (BETTING LAYOUT) --- */
        .roulette-table-area {
            flex: 2;
            background-color: #1a4a1c;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
            border: 5px solid gold;
        }
        .roulette-grid {
            display: grid;
            grid-template-columns: 1fr repeat(12, 1fr);
            gap: 3px;
            background-color: #000000;
            padding: 3px;
            border-radius: 5px;
        }
        .cell {
            background-color: #388e3c;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        .cell:hover { opacity: 0.8; }
        .zero { grid-column: 1 / 2; grid-row: 1 / span 3; background-color: #4CAF50; font-size: 1.5em; }
        .red { background-color: #D32F2F; }
        .black { background-color: #212121; }
        .winning-cell { border: 3px solid yellow !important; box-shadow: 0 0 15px yellow; }

        /* --- RUOTA E SELETTORE VICINI --- */
        .sidebar {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .roulette-wheel {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: 10px solid #ffeb3b;
            background: #212121; /* Semplificazione per l'esempio */
            margin: 20px auto;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2em;
            cursor: pointer; /* Ora Ã¨ cliccabile per puntare */
        }
        .wheel-center {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: #ffeb3b;
            color: black;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2em;
            font-weight: bold;
        }

        .neighbor-selector {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-top: 10px;
        }
        .neighbor-selector button {
            padding: 5px 10px;
            border: 1px solid #ffeb3b;
            background-color: #333;
            color: white;
            cursor: pointer;
        }
        .neighbor-selector button.selected {
            background-color: #ffeb3b;
            color: black;
            font-weight: bold;
        }
        .bet-status {
            text-align: center;
            margin-top: 10px;
            min-height: 20px;
        }

        /* --- STORICO --- */
        .history {
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            max-height: 250px;
            overflow-y: auto;
        }
        .history-list {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            list-style: none;
            padding: 0;
        }
        .history-item {
            padding: 5px 8px;
            border-radius: 50%;
            font-size: 0.8em;
            font-weight: bold;
            width: 20px;
            height: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body>

    <div class="game-controls">
        <label>Cassa Iniziale (â‚¬): <input type="number" id="bankrollInput" value="100.00" min="0.01" step="0.01"></label>
        <label>Valore Fiche (â‚¬): <input type="number" id="chipValueInput" value="1.00" min="0.10" step="0.10"></label>
        <div class="info-box">Cassa Attuale: <span id="currentBankroll">â‚¬100.00</span></div>
        <div class="info-box">Stato Gioco: <span id="gameMessage">Inserisci la cassa e punta!</span></div>
    </div>

    <div class="container">
        <div class="roulette-table-area">
            <h2>Clicca qui il NUMERO USCITO per registrare il risultato!</h2>
            <p id="betDetails">Punta prima di cliccare il risultato.</p>
            <div class="roulette-grid" id="rouletteTable">
                <div class="cell zero" data-number="0">0</div>

                <script>
                    const redNumbers = [1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36];
                    for (let col = 0; col < 12; col++) {
                        for (let row = 1; row <= 3; row++) {
                            const num = row + col * 3;
                            const colorClass = redNumbers.includes(num) ? 'red' : 'black';
                            document.write(`<div class="cell ${colorClass}" data-number="${num}">${num}</div>`);
                        }
                    }
                </script>
            </div>
        </div>

        <div class="sidebar">
            <div class="wheel-section">
                <h3>Ruota Stilizzata (Clicca per puntare)</h3>
                <div class="roulette-wheel" id="rouletteWheel">
                    <div class="wheel-center">PUNTA</div>
                </div>
                
                <div class="neighbor-controls">
                    <p>Punta Vicini (+/- n):</p>
                    <div class="neighbor-selector" id="neighborSelector">
                        <button data-neighbors="0" class="selected">Nessuno</button>
                        <button data-neighbors="1">+1</button>
                        <button data-neighbors="2">+2</button>
                        <button data-neighbors="3">+3</button>
                        <button data-neighbors="4">+4</button>
                        <button data-neighbors="5">+5</button>
                    </div>
                </div>
                <div class="bet-status" id="betStatus">Nessuna puntata attiva.</div>

            </div>

            <div class="history">
                <h3>Storico Numeri Usciti</h3>
                <ul class="history-list" id="historyList">
                </ul>
            </div>
        </div>
    </div>

    <script>
        // --- VARIABILI GLOBALI ---
        let bankroll = parseFloat(document.getElementById('bankrollInput').value);
        let chipValue = parseFloat(document.getElementById('chipValueInput').value);
        let currentNeighbors = 0; // 0 per Straight Up, 1 per +1 Vicini, ecc.
        let currentBet = null; // { number: 17, neighbors: 3, value: 3.50 }

        // Mappa dei numeri della ruota in sequenza per calcolare i vicini
        const wheelSequence = [0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26];
        const redNumbers = [1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36];

        // --- UTILITY FUNZIONI ---
        function updateDisplay() {
            document.getElementById('currentBankroll').textContent = `â‚¬${bankroll.toFixed(2)}`;
            document.getElementById('bankrollInput').value = bankroll.toFixed(2);
            document.getElementById('chipValueInput').value = chipValue.toFixed(2);
        }

        // Funzione per calcolare i numeri coperti nella puntata vicini
        function getNeighbors(number, neighborsCount) {
            if (neighborsCount === 0) return [number];
            
            const index = wheelSequence.indexOf(number);
            if (index === -1) return [];

            const coveredNumbers = new Set();
            coveredNumbers.add(number);

            for (let i = 1; i <= neighborsCount; i++) {
                // Vicino a destra (prossimo in sequenza)
                const rightIndex = (index + i) % wheelSequence.length;
                coveredNumbers.add(wheelSequence[rightIndex]);

                // Vicino a sinistra (precedente in sequenza)
                const leftIndex = (index - i + wheelSequence.length) % wheelSequence.length;
                coveredNumbers.add(wheelSequence[leftIndex]);
            }
            return Array.from(coveredNumbers);
        }

        // --- GESTIONE PUNTATE ---

        // 1. Selezione Fiche e Cassa
        document.getElementById('bankrollInput').addEventListener('change', (e) => {
            bankroll = parseFloat(e.target.value);
            updateDisplay();
        });
        document.getElementById('chipValueInput').addEventListener('change', (e) => {
            chipValue = parseFloat(e.target.value);
            // Assicura un minimo di 0.10
            if (chipValue < 0.10) {
                 chipValue = 0.10;
            }
            updateDisplay();
        });

        // 2. Selezione Vicini
        document.getElementById('neighborSelector').querySelectorAll('button').forEach(button => {
            button.addEventListener('click', (e) => {
                // Rimuovi la classe 'selected' da tutti i bottoni
                document.getElementById('neighborSelector').querySelectorAll('button').forEach(b => b.classList.remove('selected'));
                // Aggiungi la classe 'selected' al bottone cliccato
                e.target.classList.add('selected');
                
                currentNeighbors = parseInt(e.target.dataset.neighbors);
                document.getElementById('betStatus').textContent = `Pronto a puntare ${currentNeighbors * 2 + 1} numeri.`;
            });
        });

        // 3. Puntata (Clic sul placeholder Ruota)
        document.getElementById('rouletteWheel').addEventListener('click', () => {
            if (bankroll < chipValue * (currentNeighbors * 2 + 1)) {
                document.getElementById('gameMessage').textContent = `Errore: Cassa insufficiente per la puntata di â‚¬${(chipValue * (currentNeighbors * 2 + 1)).toFixed(2)}`;
                return;
            }

            // Simula la selezione di un numero al momento della puntata (es. il 17)
            // In una simulazione reale l'utente cliccherebbe il numero da puntare
            const betNumber = Math.floor(Math.random() * 37); // Numero casuale per l'esempio

            const numbersCovered = getNeighbors(betNumber, currentNeighbors);
            const totalBetValue = chipValue * numbersCovered.length;

            currentBet = {
                number: betNumber,
                neighbors: currentNeighbors,
                value: totalBetValue,
                covered: numbersCovered
            };
            
            // Deduci l'importo della puntata
            bankroll -= totalBetValue;

            document.getElementById('betStatus').textContent = `Puntata: â‚¬${totalBetValue.toFixed(2)} su ${betNumber} e ${currentNeighbors} vicini.`;
            document.getElementById('betDetails').innerHTML = `Puntata attiva su: <b>${numbersCovered.join(', ')}</b>`;
            document.getElementById('gameMessage').textContent = `Puntata registrata! Clicca il numero uscito sul tavolo.`;
            updateDisplay();
        });

        // --- GESTIONE RISULTATO E VINCITA ---

        // Event Listener per le celle del Tavolo (per dichiarare il risultato)
        document.querySelectorAll('.cell').forEach(cell => {
            cell.addEventListener('click', (e) => {
                if (!currentBet) {
                    document.getElementById('gameMessage').textContent = "Devi prima piazzare una puntata (cliccando sulla Ruota)!";
                    return;
                }

                const winningNumber = parseInt(e.currentTarget.dataset.number);
                let winAmount = 0;
                let message = "";

                // 1. Rimuovi evidenziazioni precedenti e evidenzia la cella vincente
                document.querySelectorAll('.cell').forEach(c => c.classList.remove('winning-cell'));
                e.currentTarget.classList.add('winning-cell');
                
                // 2. Verifica la vincita
                const isWinner = currentBet.covered.includes(winningNumber);
                
                if (isWinner) {
                    // La vincita su un Vicini Ã¨ pagata come 35:1 sull'importo di una singola fiche, piÃ¹ il ritorno della puntata.
                    // PoichÃ© ogni numero coperto Ã¨ puntato con una fiche:
                    winAmount = chipValue * 35; // 35:1 sul singolo numero uscito.
                    bankroll += winAmount + currentBet.value; // Ritorno della puntata + vincita netta
                    message = `ðŸŽ‰ HAI VINTO! Hai preso il numero ${winningNumber}! Guadagno netto: â‚¬${winAmount.toFixed(2)}.`;
                } else {
                    message = `ðŸ˜ž HAI PERSO. Ãˆ uscito il ${winningNumber}. I numeri coperti erano: ${currentBet.covered.join(', ')}.`;
                }

                // 3. Aggiorna Storico, Display e Reset
                addToHistory(winningNumber, isWinner);
                document.getElementById('gameMessage').textContent = message;
                document.getElementById('betStatus').textContent = 'Nessuna puntata attiva.';
                document.getElementById('betDetails').textContent = 'Punta prima di cliccare il risultato.';
                currentBet = null; // Resetta la puntata
                updateDisplay();
            });
        });

        // --- AGGIORNAMENTO STORICO ---
        function addToHistory(number, isWin) {
            const historyList = document.getElementById('historyList');
            let colorClass; 
            if (number === 0) {
                colorClass = '#4CAF50';
            } else {
                colorClass = redNumbers.includes(number) ? '#D32F2F' : '#212121';
            }

            const listItem = document.createElement('li');
            listItem.classList.add('history-item');
            listItem.textContent = number;
            listItem.style.backgroundColor = colorClass;
            
            if(isWin) {
                listItem.style.border = '2px solid gold';
                listItem.title = 'Vittoria';
            }
            
            historyList.prepend(listItem); 
        }

        // --- INIZIALIZZAZIONE ---
        updateDisplay();
    </script>

</body>
</html>
